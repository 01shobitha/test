<?xml version="1.0" encoding="iso-8859-1" ?>


<chapter id="softencoding"><title id="tsoftencoding">
<span xml:lang="en">Stream from an acquisition card or a webcam</span>
<span xml:lang="fr">Diffusez depuis une carte d'acquisition ou 
une webcam</span>
</title>

<note><para>
<span xml:lang="en">This is possible under GNU/Linux only</span>
<span xml:lang="fr">Ceci n'est possible que sous GNU/Linux</span>
.</para></note>


<sect1><title>

<span xml:lang="en">Install the Video for Linux drivers</span>
<span xml:lang="fr">Installez les drivers Video for Linux</span>
</title>

<para>
<span xml:lang="en">If you want to stream from an acquisition card
or a webcam, a video4linux driver must be available for it. You can
find more information about video4linux and supported devices <ulink
url="http://www.exploits.org/v4l">here</ulink></span>
<span xml:lang="fr">Si vous désirez diffuser depuis une carte
d'acquisition ou une webcam, un driver video4linux doit
être disponible. Vous pouvez trouver plus d'informations
sur video4linux et les périphériques supportés <ulink
url="http://www.exploits.org/v4l">ici</ulink></span>
.</para>

<para>
<span xml:lang="en">Compile the right module for your device, and insert
it into your kernel (Some video4linux modules are shipped with the 2.4.x
Linux kernels). You can test your device by using any of the listed
programs in the <emphasis>Video: TV and PVR/DVR</emphasis> section of
<ulink url="http://www.exploits.org/v4l/">this page</ulink></span>
<span xml:lang="fr">Compilez le bon module pour votre périphérique,
et insérez le dans le noyau (certains modules video4linux sont livrés
avec les noyaux Linux 2.4.x). Vous pouvez tester votre périphérique,
en utilisant l'un des programmes de la section <emphasis>Video: TV and
PVR/DVR</emphasis> de <ulink url="http://www.exploits.org/v4l/">cette
page</ulink></span>
.</para>

<para>
<span xml:lang="en">Note that v4l2 modules will also work with VLC</span>
<span xml:lang="fr">Remarque: les modules v4l2 fonctionneront
également</span>
.</para>

</sect1>

<sect1><title>
<span xml:lang="en">Stream with VLC</span>
<span xml:lang="fr">Diffusez avec VLC</span>
</title>

<note><para>
<span xml:lang="en">You must add <command>--enable-v4l</command> to
<command>./configure</command> to use this feature</span>
<span xml:lang="fr">Vous devez ajouter <command>--enable-v4l</command> à
<command>./configure</command> pour celà</span>
.</para></note>

<screen>
<!-- We cut the lines when they are too long, so that it looks OK in PDF format ! -->
<prompt>% </prompt><userinput>vlc -vvv v4l:/dev/video:norm=secam:frequency=543250:size=640x480:channel=0:adev=/dev/dsp:audio=0
--sout '#transcode{vcodec=mp4v,acodec=mpga,vb=3000,ab=256,vt=800000,keyint=80,deinterlace}:std{access=udp,mux=ts,url=239.255.12.13}' --ttl 12</userinput>
</screen>

<para><span xml:lang="en">where</span>
<span xml:lang="fr">où</span> :</para>


<itemizedlist>

<listitem><para><filename>/dev/video</filename>
<span xml:lang="en"> is the device corresponding to your acquisition
card or your webcam</span>
<span xml:lang="fr">est l'adresse correspondant à votre carte
d'acquisition ou à votre webcam</span>
,</para></listitem>

<listitem><para><emphasis>norm=secam</emphasis>
<span xml:lang="en"> is name of the standard of the analogic signal
(possible values are pal, secam, and ntsc)</span>
<span xml:lang="fr">est le nom du standard du signal analogique (celà
peut être pal, secam ou ntsc</span>
,</para></listitem>

<listitem><para><emphasis>frequency=543250</emphasis>
<span xml:lang="en"> is the frequency of the channel in khz
(<emphasis>Warning :</emphasis> for VLC &lt; 0.6.1, Frequency is channel
frequency in MHz multiplied by 16)</span>
<span xml:lang="fr">est la fréquence en kHz de la
chaîne(<emphasis>Attention:</emphasis>avec VLC &lt; 0.6.1, la fréquence
est la fréquence du canal en MHz, multipliée par 16)</span>
,</para></listitem>

<listitem><para>
<span xml:lang="en"><emphasis>size=640x480</emphasis>
is the size of the video you want (you can also put the
standard size like <emphasis>subqcif</emphasis> (128x96),
<emphasis>qsif</emphasis> (160x120), <emphasis>qcif</emphasis>
(176x144), <emphasis>sif</emphasis> (320x240), <emphasis>cif</emphasis>
(352x288) or <emphasis>vga</emphasis> (640x480))</span>
<span xml:lang="fr"><emphasis>size=640x480</emphasis> est la taille
de la vidéo que vous désirez diffuser (vous pouvez également indiquer
une taille standard, telle que <emphasis>subqcif</emphasis> (128x96),
<emphasis>qsif</emphasis> (160x120), <emphasis>qcif</emphasis>
(176x144), <emphasis>sif</emphasis> (320x240), <emphasis>cif</emphasis>
(352x288) ou <emphasis>vga</emphasis> (640x480))</span>
,</para></listitem>

<listitem><para><emphasis>channel=0</emphasis> 
<span xml:lang="en">is the number of the channel (usually 0 is for
tuner, 1 for composite and 2 for svideo)</span>
<span xml:lang="fr">est le numéro du canal (généralement, 0 pour le
tuner, 1 pour le composite, et 2 pour Svidéo)</span>
,</para></listitem>

<listitem><para><emphasis>adev=/dev/dsp</emphasis>
<span xml:lang="en">is the audio device</span>
<span xml:lang="fr">est le périphérique audio</span>
,</para></listitem>

<listitem><para><emphasis>audio=1</emphasis> 
<span xml:lang="en">is the number of the audio
channel (usually 0 is for mono and 1 for stereo)</span>
<span xml:lang="fr">est le numéro du canal audio (généralement, 0 pour
mono et 1 pour stéréo)</span>
,</para></listitem>

<listitem><para><emphasis>vcodec=mp4v</emphasis> 
<span xml:lang="en">is the video format you want to encode in
(<emphasis>mp4v</emphasis> is MPEG-4, <emphasis>mpgv</emphasis> is
MPEG-1, and there is also</span>
<span xml:lang="fr">est le format d'encodage vidéo
(<emphasis>mp4v</emphasis> pour MPEG-4, <emphasis>mpgv</emphasis> pour
MPEG-1, mais aussi</span>
<emphasis>h263</emphasis>, <emphasis>DIV1</emphasis>,
<emphasis>DIV2</emphasis>, <emphasis>DIV3</emphasis>,
<emphasis>I420</emphasis>, <emphasis>I422</emphasis>,
<emphasis>I444</emphasis>, <emphasis>RV24</emphasis>,
<emphasis>YUY2</emphasis>),</para></listitem>

<listitem><para><emphasis>acodec=mpga</emphasis> 
<span xml:lang="en">is the audio format you want to encode
in (<emphasis>mpga</emphasis> is MPEG audio layer 2,
<emphasis>a52</emphasis> is A52 i.e. AC3 sound)</span>
<span xml:lang="fr">est le format audio d'encodage
(<emphasis>mpga</emphasis> pour MPEG audio layer 2,
<emphasis>a52</emphasis> pour A52 / AC3)</span>
,</para></listitem>

<listitem><para><emphasis>vb=3000</emphasis>
<span xml:lang="en"> is the video bitrate in Kbit/s</span>
<span xml:lang="fr">est le taux de compression vidéo en Kbps</span>
,</para></listitem>

<listitem><para><emphasis>ab=256</emphasis>
<span xml:lang="en"> is the audio bitrate in Kbit/s</span>
<span xml:lang="fr">est le taux de compression audio en Kbps</span>
</para></listitem>

<listitem><para><emphasis>vt=800000</emphasis>
<span xml:lang="en"> is the video bitrate tolerance in bit/s</span>
<span xml:lang="fr">est la tolérance sur le bitrate vidéo en bps</span>
,</para></listitem>

<listitem><para><emphasis>keyint=80</emphasis>
<span xml:lang="en"> is the maximum interval between two "I" images in
number of images</span>
<span xml:lang="fr">est le nombre maximal d'image entre deux images
"I"</span>
,</para></listitem>

<listitem><para><emphasis>deinterlace</emphasis>
<span xml:lang="en">tells VLC to deinterlace the video on the fly</span>
<span xml:lang="fr">pour désentrelacer le flux à la volée</span>
,</para></listitem>

<listitem><para><emphasis>192.168.0.42</emphasis>
<span xml:lang="en"> is either </span>
<span xml:lang="fr"> est soit </span>
:</para>

<itemizedlist>
<listitem><para>
<span xml:lang="en">the IP address of the machine you want to unicast
to</span>
<span xml:lang="fr">l'adresse IP de la machine vers laquelle vous
désirez diffuser en unicast</span>
;</para></listitem>

<listitem><para>
<span xml:lang="en">or the DNS name the machine you want to unicast
to</span>
<span xml:lang="fr">le nom DNS de la machine vers laquelle vous désirez
envoyer en unicast</span>
;</para></listitem>

<listitem><para>
<span xml:lang="en">or a multicast IP address</span>
<span xml:lang="fr">une adresse IP multicast</span>
.</para></listitem>


</itemizedlist>

</listitem>

<listitem><para><emphasis>12</emphasis>
<span xml:lang="en"> is the value of the TTL (Time To
Live) of your IP packets (which means that the stream will be
able to cross 11 routers)</span>
<span xml:lang="fr"> est la valeur du TTL (Time To Live) de vos paquets
IP (cela signifie qu'ils pourront traverser 11 routeurs)</span>
.</para></listitem>

</itemizedlist>

</sect1>

<sect1><title>
<span xml:lang="en">Stream with VLS</span>
<span xml:lang="fr">Diffusez avec VLS</span>
</title>

<note><para>
<span xml:lang="en">You need the CVS version of VLS. When you
compile it, you must do a <command>./bootstrap</command> and
 <command>./configure --enable-v4l
--with-ffmpeg=PATH</command> (where <emphasis>PATH</emphasis> is the
absolute path to the directory where you compiled ffmpeg, and not the
relative path !)</span>
<span xml:lang="fr">Vous devez avoir la version CVS de VLS. Quand vous
la compilez, vous devez utiliser <command>./bootstrap</command> puis
 <command>./configure --enable-v4l
--with-ffmpeg=PATH</command> (avec <emphasis>PATH</emphasis> le chemin
absolu vers le répertoire où vous avez compilé ffmpeg, et non pas le
chemin relatif !)</span>
.</para></note>

<para>
<span xml:lang="en">There is no command line interface for this input
for the moment, so you will have to use the configuration file</span>
<span xml:lang="fr">Il n'existe pas de ligne de commande pour ce
type d'entrée pour l'instant, vous devez utiliser le fichier de
configuration</span>
.</para>

<para>
<span xml:lang="en">Here is a typical configuration file
<filename>vls.cfg</filename>to run VLS with a v4l device</span>
<span xml:lang="fr">Voici un fichier <filename>vls.cfg</filename>typique
pour faire marcher VLS avec un périphérique v4l</span>
:</para>

<programlisting>
# vls.cfg (VLS configuration file)
# Example of the VideoLAN HOWTO for the Video for Linux input

BEGIN "Inputs"

  webcam       = "v4l"

END

BEGIN "webcam"

  # V4L device
  Device        = "/dev/video"

  # Channel Source : Webcam is often "0"
  #                  TV Card, may be Tuner(0), Composite(1), Svideo(2)
  Channel       = "0"

  # Norm: PAL=0, NTSC=1, SECAM=2
  Norm          = "0"

  # Frequency of the channel in Mhz, multiplied by 16 (tuner cards only)
  Frequency     = "7668"

  # Size possibilities: can be either:
  # - empty string : default size
  # - width x height
  # - subQCIF(128x96), QSIF(160x120), QCIF(176x144), SIF(320x240),
  #   CIF(352x288), VGA (640x480)
  Size          = ""

  # DeInterlace: "0" = no ; "1" = yes
  DeInterlace   = "0"

  # Video compression format: "mpeg1" or "mpeg4"
  Compression   = "mpeg4"

  # Video bitrate (approx.) in kbps
  Bitrate       = "500"

  # Quality: "1.0" (good) to "31.0" (bad)
  Quality       = "1.0"

  # Sound device
  AudioDevice   = "/dev/dsp"

  # Audio compression format: "mp2", "mp3" or "ogg"
  AudioCompression = "mp2"

  # Audio bitrate in kpbs
  AudioBitrate  = "64"

  # Audio frequency ("16000", "22050", "24000", "32000", "44100" or "48000")
  AudioFreq     = "16000"

  # Audio channel: "1" = mono ; "2" = stereo
  AudioChannel  = "2"

END

BEGIN "Channels"

  channel1       = "network"

END

BEGIN "channel1"

  # Unicast or multicast IP address
  DstHost = "192.168.0.42"

  # Destination port
  DstPort = "1234"

  # If it's a multicast IP address, uncomment the line below
  #Type    = "multicast"

  # If it's a multicast IP address, set the "Time To Live" below
  #TTL     = "12"

END

BEGIN "LaunchOnStartUp"

  command1 = "start video channel1 webcam"

END
</programlisting>

<para>
<span xml:lang="en">Once you have adapted the configuration file above,
run VLS</span>
<span xml:lang="fr">Une fois que vous avez adapté ce fichier de
configuration, lancez VLS</span>
:</para>



<screen>
<prompt>% </prompt><userinput>vls -vv -f vls.cfg</userinput>
</screen>

</sect1>
</chapter>

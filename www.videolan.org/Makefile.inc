# Subdirectories to be preprocessed
SUBDIR = doc security support vlc videolan projects developers locale press vlmc

# Files to be preprocessed
#PHP_FILES = # automatic
PHP_IGNORES = mirror mirror-geo retrieve get_count mirror-geo-redirect

# Additionnal dependencies

news.html: news.msg

news-rss.html: news.msg

index.html: news.msg

style/style.css: style/style.css.in
	@echo "Processing $@.in ..."
	yui-compressor --type css $< > $@.tmp || cp $< $@.tmp
	rm -f $@ && mv $@.tmp $@

include/mirrors.php: include/mirrors
	@echo "Processing $< ..."
	awk -F '|' 'BEGIN { print "<?php\n/* This file is automatically generated from the mirrors file. Do not edit */\n$$mirrors = array(" } !/^#/{print "  array( \""$$1"\", \""$$2"\", \""$$3"\", \""$$4"\", \""$$5"\", "$$6" ),"} END { print ");\n?>" }' $< > $<.php

style/countries.css: include/mirrors
	@echo "Processing $@.in ..."
	echo "/* Auto generated. Do not edit. */" > $@
	rm -f $@
	awk -F '|' '!/^#/ { print $$4; }' $<|sort|uniq|awk '{ print "#maincontent table td."$$1; print " { padding-left:2em; background: url(http://images.videolan.org/images/flags/"$$1".png) left no-repeat; }" }' >> $@

locales: index.an.php index.ast.php index.bg.php index.bn_IN.php index.bs.php index.by.php index.cs.php index.da.php index.de.php index.dk.php index.el.php index.es.php index.et.php index.fi.php index.fr.php index.gd.php index.ge.php index.gl.php index.gu_IN.php index.he.php index.hi.php index.ja.php index.km.php index.mk.php index.mr.php index.nb.php index.nl.php index.or.php index.pl.php index.pt.php index.pt_BR.php index.ro.php index.ru.php index.sk.php index.sr.php index.th.php index.tr.php index.ur.php index.wa.php index.zh.php

